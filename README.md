# Тестирование API

## 1. Задание

Вам предоставлена для тестирования промежуточная версия API сервиса объявлений. Вам нужно проверить эту реализованную часть функционала сервиса.

Требования расположены внутри проекта в папке tz (tz.pdf)
## 2. Требования к решению

* создана postman-коллекция, при необходимости добавляйте скрипты, внешние ТД и т.д.
* написан чек-лист проверок
* найден и исправлен баг внутри сервиса
* написаны тест-кейсы и выполнены все проверки (позже)

Решение должно быть оформлено следующим образом:
- postman-коллекция (json-файл)
- чек лист проверок, произвольно
- при необходимости  можете создавать любые CRUD запросы, подготавливающие окружение перед запуском теста
- в остальном, структура коллекции и решения может быть любой как вам кажется логичнее

## 3. Критерии оценки  

Для получения 8 баллов и зачета достаточно протестировать CRUD для сущности Advertisement.
Для получения 12 баллов нужно найти хотя бы 2 ошибки, заложенные в сервисе. 
А для получения 16 баллов вам нужно максимально полно протестировать одно из предложенных на выбор требований из ТЗ.

Требования, которые нужно протестировать для получения 16 баллов:
- протестировать работу фильтра `GET /ads?location={location_name}`
- протестировать работу фильтра `GET /ads?category={category_name}&price={price_value}`
- протестировать корректность заполнения поля `Location` в `Advertisement`

## 4. Запуск проекта

### 4.1. Создание виртуального окружения

Для установки пакетов, используемых при работе приложения,
желательно создать [виртуальное окружение](https://docs.python.org/3/library/venv.html#creating-virtual-environments).
Создавать можно через консоль:

    $ python3 -m venv venv 

После этого в текущей папке появится вложенная папка venv. Для активации окружения
в unix-подобных системах используется команда:

    $ source venv/bin/activate

После этого в приглашении командной строки появится префикс, указывающий,
что в дальнейшей работе используется интерпретатор и набор пакетов из выбранного
окружения:

    $ which python3
    /usr/local/bin/python3

    $ source venv/bin/activate
    
    (venv) $ which python3
    /.../venv/bin/python3

Виртуальное окружение также может быть создано через среду разработки. Например,
для PyCharm создание описано [здесь](https://www.jetbrains.com/help/pycharm/creating-virtual-environment.html)

### 4.2. Установка пакетов

После активации окружения необходимо установить пакеты. Это можно сделать с помощью
команды pip:

    (venv) $ pip install -r requirements.txt

Подготовка окружения на этом завершена.

### 4.3. Инициализация БД

В приложении используется локальная sqlite база данных. По умолчанию файл бд
будет создан в корневой папке проекта с именем `adapi.db`. При необходимости
путь можно изменить через параметры запуска в среде разработки или через
переменную окружения в консоли:

    $ export DB_URL=sqlite:///mydb.db

или для Windows:

    $ set DB_URL=sqlite:///mydb.db

Обратите внимание, что устанавливаемая через консоль переменная окружения
существует только в конкретном сеансе терминала.

Для создания таблиц БД необходимо выполнить процедуру миграции БД. Миграции
выполняются с помощью пакета
[alembic](https://alembic.sqlalchemy.org/en/latest/tutorial.html) и хранятся
в папке `./alembic/versions`. Для накатки миграций в пустую БД используется
команда:

    $ alembic upgrade head

    INFO  [alembic.runtime.migration] Context impl SQLiteImpl.
    INFO  [alembic.runtime.migration] Will assume non-transactional DDL.
    INFO  [alembic.runtime.migration] Running upgrade  -> 4d8b6f9ed766, init

### 4.4 Первоначальное заполнение данных в БД

Для приведения базы данных в первоначальное состояние, а также заполнения
таблиц справочников данными может быть выполнена команда:

    $ python -m cli

Внимание! После выполнения команды данные в таблицаx `Ad`, `Author` будут стерты.

### 4.5. Запуск сервера

После накатки миграций и заполнения таблиц справочников может быть выполнен запуск
локального сервера:

    $ uvicorn server:app
    
    INFO:     Started server process [48489]
    INFO:     Waiting for application startup.
    INFO:     Application startup complete.
    INFO:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)

По умолчанию сервер слушает соединения с локального хоста на порт `8000`
(как в примере выше).
Документация по api генерируется сервером автоматически и доступна через
браузер http://127.0.0.1:8000/docs
